# bot/routers/fallback.py
import random
from aiogram import Router, types, F
from aiogram.filters import StateFilter
from bot.keyboards.student import student_main_kb

router = Router(name="fallback")

_fun_replies = [
    "–≠—Ç–æ –∫–æ–Ω–µ—á–Ω–æ —Å–∏–ª—å–Ω–æ... –Ω–æ –¥–∞–≤–∞–π –ø–æ –¥–µ–ª—É üòÖ",
    "–Ø –º—É–∑—ã–∫–∞–Ω—Ç - –µ–Ω–æ—Ç, –∞ –Ω–µ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç üôÉ",
    "–°–Ω–∞—á–∞–ª–∞ —É—Ä–æ–∫ —Å–¥–∞–π, –ø–æ—Ç–æ–º –ø–æ–≥–æ–≤–æ—Ä–∏–º üé∏",
    "–ï—Å–ª–∏ —ç—Ç–æ –∞–∫–∫–æ—Ä–¥ ‚Äî —è –µ–≥–æ –Ω–µ –∑–Ω–∞—é üòÇ",
    "–ù—É —Ç—ã –ø–æ–Ω—è–ª... –∂–º–∏ –∫–Ω–æ–ø–∫–∏, –∞ –Ω–µ —Å—é–¥–∞ –ø–∏—à–∏ üëá",
    "–ú–∞–µ—Å—Ç—Ä–æ—Ñ—Ñ —É—Ä–æ–Ω–∏–ª –º–µ–¥–∏–∞—Ç–æ—Ä, –ø–æ–¥–æ–∂–¥–∏, —è –µ–≥–æ –Ω–∞–π–¥—É...",
    "–Ø –∂–µ –±–æ—Ç, –∞ –Ω–µ —Ç–≤–æ—è –±–∞–±—É—à–∫–∞ ü§®",
]

# --- –ï–î–ò–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø –ù–ï–ü–û–ù–Ø–¢–ù–û–ì–û –¢–ï–ö–°–¢–ê ---
@router.message(StateFilter(None), F.text, ~F.text.startswith("/"))
async def unified_fallback_text(m: types.Message):
    # –û—Ç–≤–µ—á–∞–µ–º —à—É—Ç–∫–æ–π —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 35%
    if random.random() < 0.35:
        await m.answer(random.choice(_fun_replies))
    else:
        # –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –æ—Ç–≤–µ—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ
        await m.answer("–ù–µ –ø–æ–Ω—è–ª. –ù–∞–∂–º–∏ /start –∏–ª–∏ –≤—ã–±–µ—Ä–∏ –ø—É–Ω–∫—Ç –º–µ–Ω—é.", reply_markup=student_main_kb())

# --- –ï–î–ò–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø –ù–ï–ê–ö–¢–ò–í–ù–´–• –ö–ù–û–ü–û–ö ---
@router.callback_query(StateFilter(None))
async def fallback_cb_unified(cb: types.CallbackQuery):
    # –ú—ã –º–æ–∂–µ–º –ø—Ä–æ—Å—Ç–æ –ª–æ–≤–∏—Ç—å –í–°–ï –∫–æ–ª–±—ç–∫–∏ –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è,
    # —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ "—Ä–∞–±–æ—á–∏–µ" –∫–æ–ª–±—ç–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥—Ä—É–≥–∏—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö,
    # –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ—è—Ç —Ä–∞–Ω—å—à–µ –≤ main.py.
    # –≠—Ç–æ –Ω–∞–¥–µ–∂–Ω–µ–µ, —á–µ–º –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å –≤—Å–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã.
    await cb.answer("–≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞.", show_alert=False)